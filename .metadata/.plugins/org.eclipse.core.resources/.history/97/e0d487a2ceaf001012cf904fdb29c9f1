package test_persistencia;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

import modeloDatos.Administrador;
import modeloDatos.Auto;
import modeloDatos.Chofer;
import modeloDatos.ChoferPermanente;
import modeloDatos.ChoferTemporario;
import modeloDatos.Cliente;
import modeloDatos.Combi;
import modeloDatos.Moto;
import modeloDatos.Pedido;
import modeloDatos.Vehiculo;
import modeloDatos.Viaje;
import modeloNegocio.Empresa;
import persistencia.EmpresaDTO;
import util.Constantes;

public class AuxiliarPersistenciaTesting {

    public static void guardar(Object obj, Path ruta) throws IOException {
        try (ObjectOutputStream oos = new ObjectOutputStream(Files.newOutputStream(ruta))) {
            oos.writeObject(obj);
        }
    }

    public static <T> T cargar(Path ruta) throws IOException, ClassNotFoundException {
        try (ObjectInputStream ois = new ObjectInputStream(Files.newInputStream(ruta))) {
            return (T) ois.readObject();
        }
    }
    
    public static EmpresaDTO crearEmpresaDTOGenerico() {
        EmpresaDTO dto = new EmpresaDTO();

        // --- Choferes ---
        ChoferTemporario chT1 = new ChoferTemporario("1122233", "Jose Perez");
        ChoferTemporario chT2 = new ChoferTemporario("4422233", "Perez Jose");
        ChoferPermanente chP1 = new ChoferPermanente("12333444", "Armando Paredez", 2000, 1);
        ChoferPermanente chP2 = new ChoferPermanente("12311244", "Pablito Clavito", 2000, 1);

        HashMap<String, Chofer> mapaChoferes = new HashMap<>();
        mapaChoferes.put("1122233", chT1);
        mapaChoferes.put("4422233", chT2);
        mapaChoferes.put("12333444", chP1);
        mapaChoferes.put("12311244", chP2);
        dto.setChoferes(mapaChoferes);

        ArrayList<Chofer> choferesDesocupados = new ArrayList<>();
        choferesDesocupados.add(chT1);
        choferesDesocupados.add(chP1);
        dto.setChoferesDesocupados(choferesDesocupados);

        // --- Clientes ---
        Cliente cli1 = new Cliente("nombreUsuario1", "pass1", "nombreReal1");
        Cliente cli2 = new Cliente("nombreUsuario2", "pass2", "nombreReal2");
        Cliente cli3 = new Cliente("nombreUsuario3", "pass3", "nombreReal3");

        HashMap<String, Cliente> mapaClientes = new HashMap<>();
        mapaClientes.put("nombreUsuario1", cli1);
        mapaClientes.put("nombreUsuario2", cli2);
        mapaClientes.put("nombreUsuario3", cli3);
        dto.setClientes(mapaClientes);

        // --- Pedidos ---
        Pedido ped1 = new Pedido(cli1, 7,  true,  false, 10,  Constantes.ZONA_PELIGROSA);
        Pedido ped2 = new Pedido(cli2, 9,  false, true,  321, Constantes.ZONA_STANDARD);
        HashMap<Cliente, Pedido> mapaPedidos = new HashMap<>();
        mapaPedidos.put(cli1, ped1);
        mapaPedidos.put(cli2, ped2);
        dto.setPedidos(mapaPedidos);

        // --- Usuario logeado ---
        dto.setUsuarioLogeado(Administrador.getInstance());

        // --- Veh√≠culos ---
        Vehiculo moto  = new Moto("MM123MM");
        Vehiculo auto  = new Auto("AA123AA", 3, true);
        Vehiculo combi = new Combi("CC123CC", 8, false);

        HashMap<String, Vehiculo> mapaVehiculos = new HashMap<>();
        mapaVehiculos.put("MM123MM", moto);
        mapaVehiculos.put("AA123AA", auto);
        mapaVehiculos.put("CC123CC", combi);
        dto.setVehiculos(mapaVehiculos);

        ArrayList<Vehiculo> vehiculosDesocupados = new ArrayList<>();
        vehiculosDesocupados.add(moto);
        vehiculosDesocupados.add(combi);
        dto.setVehiculosDesocupados(vehiculosDesocupados);

        // --- Viajes iniciados ---
        Viaje v1 = new Viaje(ped1, chT1, auto);
        Viaje v2 = new Viaje(ped2, chT2, combi);
        HashMap<Cliente, Viaje> viajesIniciados = new HashMap<>();
        viajesIniciados.put(cli1, v1);
        viajesIniciados.put(cli2, v2);
        dto.setViajesIniciados(viajesIniciados);

        // --- Viajes terminados ---
        Pedido ped3 = new Pedido(cli3, 5, true, true, 45, Constantes.ZONA_STANDARD);
        Viaje v3 = new Viaje(ped3, chP1, moto);
        ArrayList<Viaje> viajesTerminados = new ArrayList<>();
        viajesTerminados.add(v3);
        dto.setViajesTerminados(viajesTerminados);
        
        return dto;
    }	
    
    private static boolean choferesIguales(EmpresaDTO empresaDTO, EmpresaDTO empresa) {
    	String choferesDTO = empresaDTO.getChoferes().toString();
    	String choferesEmpresa = empresa.getChoferes().toString();
    	return choferesDTO.equals(choferesEmpresa);
    }
    
    private static boolean choferesDesocupadosIguales(EmpresaDTO empresaDTO, EmpresaDTO empresa) {
    	String choferesDesocupadosDTO = empresaDTO.getChoferesDesocupados().toString();
    	String choferesDesocupadosEmpresa = empresa.getChoferesDesocupados().toString();    	
    	return choferesDesocupadosDTO.equals(choferesDesocupadosEmpresa);
    }
    
    private static boolean clientesIguales(EmpresaDTO empresaDTO, EmpresaDTO empresa) {
        String clientesDTO = empresaDTO.getClientes().toString();
        String clientesEmpresa = empresa.getClientes().toString();
        return clientesDTO.equals(clientesEmpresa);
    }

    private static boolean vehiculosIguales(EmpresaDTO empresaDTO, EmpresaDTO empresa) {
        String vehiculosDTO = empresaDTO.getVehiculos().toString();
        String vehiculosEmpresa = empresa.getVehiculos().toString();
        return vehiculosDTO.equals(vehiculosEmpresa);
    }
    
    private static boolean vehiculosDesocupadosIguales(EmpresaDTO empresaDTO, EmpresaDTO empresa) {
        String vehiculosDesocupadosDTO = empresaDTO.getVehiculosDesocupados().toString();
        String vehiculosDesocupadosEmpresa = empresa.getVehiculosDesocupados().toString();
        return vehiculosDesocupadosDTO.equals(vehiculosDesocupadosEmpresa);
    }

    private static boolean pedidosIguales(EmpresaDTO empresaDTO, EmpresaDTO empresa) {
        String pedidosDTO = empresaDTO.getPedidos().toString();        
        String pedidosEmpresa = empresa.getPedidos().toString();
        pedidosDTO = sortString(pedidosDTO);
        pedidosEmpresa = sortString(pedidosEmpresa);
        return pedidosDTO.equals(pedidosEmpresa);
    }
    
    private static String sortString(String str) {
        char[] charArray = str.toCharArray();
        Arrays.sort(charArray);
        return new String(charArray);
    }

    private static boolean viajesIniciadosIguales(EmpresaDTO empresaDTO, EmpresaDTO empresa) {
        String viajesIniciadosDTO = empresaDTO.getViajesIniciados().toString();
        String viajesIniciadosEmpresa = empresa.getViajesIniciados().toString();
        viajesIniciadosDTO = sortString(viajesIniciadosDTO);
        viajesIniciadosEmpresa = sortString(viajesIniciadosEmpresa);
        return viajesIniciadosDTO.equals(viajesIniciadosEmpresa);
    }

    private static boolean viajesTerminadosIguales(EmpresaDTO empresaDTO, EmpresaDTO empresa) {
        String viajesTerminadosDTO = empresaDTO.getViajesTerminados().toString();
        String viajesTerminadosEmpresa = empresa.getViajesTerminados().toString();
        return viajesTerminadosDTO.equals(viajesTerminadosEmpresa);
    }

    public static boolean sonIguales(EmpresaDTO dto, EmpresaDTO emp) {
        return clientesIguales(dto, emp)
            && choferesIguales(dto, emp)
            && vehiculosIguales(dto, emp)
            && choferesDesocupadosIguales(dto, emp)
            && vehiculosDesocupadosIguales(dto, emp)
            && pedidosIguales(dto, emp)
            && viajesIniciadosIguales(dto, emp)
            && viajesTerminadosIguales(dto, emp);
    }
    
//    public static boolean sonIguales(EmpresaDTO dto, EmpresaDTO emp) { 
//    	if(!clientesIguales(dto, emp)) 
//    		System.out.println("CLIENTES IGUALES"); 
//    	if(!choferesIguales(dto, emp)) 
//    		System.out.println("CHOFERES IGUALES"); 
//    	if(!vehiculosIguales(dto, emp)) 
//    		System.out.println("VEHICULOS IGUALES"); 
//    	if(!choferesDesocupadosIguales(dto, emp)) 
//    		System.out.println("CHOFERES DESOCUPADOS IGUALES"); 
//    	if(!vehiculosDesocupadosIguales(dto, emp)) 
//    		System.out.println("VEHICULSO DESOCUPADOS IGUALES"); 
//    	if(!pedidosIguales(dto, emp)) 
//    		System.out.println("PEDIDOS IGUALES"); 
//    	if(!viajesIniciadosIguales(dto, emp)) 
//    		System.out.println("viajes inicniadosIGUALES"); 
//    	if(!viajesTerminadosIguales(dto, emp)) 
//    		System.out.println("viajes terminaersIGUALES"); 
//    	return true; 
//    }

    
	
	
}
